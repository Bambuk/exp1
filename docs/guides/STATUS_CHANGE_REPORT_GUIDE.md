# Инструкция по использованию отчёта о статусах CPO задач

## Описание

Команда `generate_status_change_report` генерирует отчёт о статусах CPO задач за последние 2 недели. Отчёт показывает активность авторов по изменениям статусов и количеству задач, а также текущие открытые задачи, разделённые по блокам Discovery и Delivery.

## Что показывает отчёт

### Временные периоды
- **Неделя 1**: Последние 7 дней (от сегодня)
- **Неделя 2**: Предыдущие 7 дней (7-14 дней назад)
- **Неделя 3**: Скрытая неделя (14-21 день назад) - используется для расчёта динамики

### Метрики для каждой недели
- **Активность**: Количество изменений статусов и уникальных задач в одном поле

### Текущие открытые задачи
- **Discovery**: Количество задач в блоке Discovery (анализ, планирование) + дата последнего изменения статуса
- **Delivery**: Количество задач в блоке Delivery (разработка, тестирование) + дата последнего изменения статуса

### Индикаторы динамики
- ▲ - Улучшение (рост показателей)
- ▼ - Снижение показателей  
- → - Без изменений

## Способы запуска

### 1. Через Python модуль
```bash
# Запуск с настройками по умолчанию
python -m radiator.commands.generate_status_change_report

# С указанием имён файлов
python -m radiator.commands.generate_status_change_report --csv my_report.csv --table my_table.png
```

### 2. Через Makefile (если добавлена команда)
```bash
make generate-status-report
```

### 3. Программно в Python коде
```python
from radiator.commands.generate_status_change_report import GenerateStatusChangeReportCommand

with GenerateStatusChangeReportCommand() as cmd:
    success = cmd.run()
```

## Параметры командной строки

- `--csv FILENAME` - Имя CSV файла (по умолчанию: `status_change_report_YYYYMMDD_HHMMSS.csv`)
- `--table FILENAME` - Имя файла таблицы (по умолчанию: `status_change_table_YYYYMMDD_HHMMSS.png`)

## Выходные файлы

### 1. CSV отчёт
- **Расположение**: Папка `reports/`
- **Формат**: CSV с колонками:
  - Автор
  - [Дата]_активность (изменения + задачи + динамика)
  - Discovery
  - Delivery

### 2. Визуальная таблица
- **Расположение**: Папка `reports/`
- **Формат**: PNG изображение с цветной таблицей
- **Содержание**: Те же данные, что и в CSV, но с улучшенным форматированием

## Примеры использования

### Базовый запуск
```bash
cd /path/to/radiator
python -m radiator.commands.generate_status_change_report
```

### С указанием имён файлов
```bash
python -m radiator.commands.generate_status_change_report \
  --csv cpo_report_$(date +%Y%m%d).csv \
  --table cpo_table_$(date +%Y%m%d).png
```

### Автоматизация через cron
```bash
# Добавить в crontab для ежедневного запуска в 9:00
0 9 * * * cd /path/to/radiator && python -m radiator.commands.generate_status_change_report
```

## Интерпретация результатов

### Анализ активности авторов
- **Высокая активность**: Много изменений статусов и задач
- **Низкая активность**: Мало изменений, возможно блокировки
- **Динамика**: Стрелки показывают тренд по сравнению с предыдущим периодом

### Анализ блоков задач
- **Discovery > Delivery**: Преобладает аналитическая работа
- **Delivery > Discovery**: Преобладает разработка
- **Сбалансированно**: Равномерное распределение

### Выявление проблем
- Авторы с нулевой активностью
- Резкие падения активности (красные стрелки)
- Неравномерное распределение по блокам

## Требования

- Python 3.8+
- Доступ к базе данных с данными Tracker
- Установленные зависимости: `matplotlib`, `pandas`
- Папка `reports/` для сохранения файлов

## Устранение неполадок

### Ошибка "No data found"
- Проверьте подключение к базе данных
- Убедитесь, что есть данные за указанный период
- Проверьте фильтр CPO задач

### Ошибка matplotlib
- Установите зависимости: `pip install matplotlib`
- Для серверов без GUI используйте: `export MPLBACKEND=Agg`

### Проблемы с кодировкой
- Проверьте настройки локали системы
- Убедитесь, что база данных использует UTF-8

## Настройка

### Изменение временных периодов
Отредактируйте метод `generate_report_data()` в файле `radiator/commands/generate_status_change_report.py`:

```python
# Изменить количество дней для каждой недели
week1_start = week1_end - timedelta(days=7)  # 7 дней
week2_start = week2_end - timedelta(days=7)  # 7 дней
```

### Изменение статусов блоков
Отредактируйте файл `data/config/status_order.txt` для настройки маппинга статусов на блоки Discovery/Delivery.

## Поддержка

При возникновении проблем:
1. Проверьте логи в консоли
2. Убедитесь в корректности данных в базе
3. Проверьте права доступа к папке `reports/`
4. Обратитесь к разработчикам с логами ошибок
